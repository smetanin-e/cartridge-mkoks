generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Model {
    id         Int         @id @default(autoincrement())
    model      String      @unique
    cartridges Cartridge[] // 1 → many

    printers Printer[]
}

model Cartridge {
    id     Int    @id @default(autoincrement())
    number String @unique // Уникальный номер картриджа (например, МК101)

    modelId Int
    model   Model @relation(fields: [modelId], references: [id]) // many → 1

    status CartridgeStatus @default(AVAILABLE)

    // Связи с записями о заменах
    replacementInstalled Replacement[] @relation("InstalledCartridge")
    replacementRemoved   Replacement[] @relation("RemovedCartridge")
}

enum CartridgeStatus {
    SERVICE // В сервисе
    WORKING // В работе
    RESERVE // Сняты с обслуживания
    AVAILABLE // Готовы к использованию
    REFILL // Требуется заправка
}

model Printer {
    id     Int     @id @default(autoincrement())
    name   String
    models Model[]
}

model Departament {
    id   Int    @id @default(autoincrement())
    name String

    replacements Replacement[]
}

enum BatchStatus {
    in_progress // В стадии заправки (отправлена в сервис)
    completed // Выполнено (все картриджи вернулись)
    partial_return // Частичный возврат (некоторые картриджи вернулись)
}

model Replacement {
    id   Int    @id @default(autoincrement())
    date String

    departament   Departament @relation(fields: [departamentId], references: [id])
    departamentId Int

    installedCartridgeNumber String? // Номер установленного картриджа
    removedCartridgeNumber   String? // Номер снятого картриджа
    responsible              String // Ответственный за исполнение
    createdAt                DateTime @default(now())

    installedCartridge Cartridge? @relation("InstalledCartridge", fields: [installedCartridgeNumber], references: [number])
    removedCartridge   Cartridge? @relation("RemovedCartridge", fields: [removedCartridgeNumber], references: [number])
}
